<!-- Loading State -->
@if (loading) {
  <div class="loading-container">
    <mat-spinner diameter="60"></mat-spinner>
    <p>טוען...</p>
  </div>
}

<!-- Error State -->
@if (error) {
  <div class="error-container">
    <mat-icon>error_outline</mat-icon>
    <h2>ארגון לא נמצא</h2>
    <p>לא מצאנו את הארגון המבוקש</p>
  </div>
}

<!-- Main Content -->
@if (organization && !loading && !error) {
  <div class="detail-container">
    <div class="main-content">
      <!-- Greeting Card -->
      <div class="greeting-card">
        <h1>שלום {{ organization.name }}</h1>
      </div>
      
      <!-- Prompt Editor Card -->
      <div class="prompt-editor-card">
        <label class="prompt-label">פרומפט</label>
        <textarea 
          [(ngModel)]="organization.prompt"
          class="prompt-textarea"
          placeholder="הזן את הפרומפט כאן..."
          dir="rtl">
        </textarea>
      </div>

      <!-- Actions Section -->
      <div class="actions-section">
        <button 
          mat-raised-button 
          color="primary" 
          (click)="save()"
          [disabled]="!isModified || saving || loadingSuggestion"
          class="action-btn">
          @if (saving) {
            <mat-spinner diameter="20" class="btn-spinner"></mat-spinner>
          }
          @if (!saving) {
            <mat-icon>save</mat-icon>
          }
          שמור
        </button>
      </div>
    </div>

    <!-- Suggestion Sidebar -->
    <div class="suggestion-sidebar">
      <!-- Loading Suggestion State -->
      @if (loadingSuggestion) {
        <div class="suggestion-loading">
          <mat-spinner diameter="40"></mat-spinner>
          <p>מקבל הצעת שיפור...</p>
        </div>
      }

      <!-- AI Suggestion Card -->
      @if (suggestion && !loadingSuggestion) {
        <div class="suggestion-card">
          <div class="suggestion-header">
            <mat-icon>lightbulb</mat-icon>
            <h3>הצעה משופרת</h3>
          </div>
          <div class="suggestion-content">
            {{ suggestion }}
          </div>
          <div class="suggestion-actions">
            <button mat-raised-button color="primary" (click)="acceptSuggestion()" class="approve-btn">
              <mat-icon>check</mat-icon>
              אשר הצעה
            </button>
            <button mat-stroked-button (click)="rejectSuggestion()" class="decline-btn">
              <mat-icon>close</mat-icon>
              דחה הצעה
            </button>
          </div>
        </div>
      }

      <!-- Placeholder when no suggestion -->
      @if (!suggestion && !loadingSuggestion) {
        <div class="suggestion-placeholder">
          <mat-icon>auto_awesome</mat-icon>
          <p>הצעות שיפור יופיעו כאן לאחר שמירה</p>
        </div>
      }
    </div>
  </div>
}
